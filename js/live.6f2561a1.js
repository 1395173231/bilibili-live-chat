(function(){"use strict";var e={657:function(e,t,n){n(3943);var a=n(9963),o=n(6460),s=(n(4415),n(3168)),i=n(6252),r=n(3577);const l={class:"el-dropdown-link",style:{"font-size":"15px",display:"inline-block","margin-left":"auto"}};function u(e,t,n,a,o,s){const u=(0,i.up)("danmaku-item"),c=(0,i.up)("live"),d=(0,i.up)("el-main"),m=(0,i.up)("el-container"),f=(0,i.up)("arrow-down"),p=(0,i.up)("el-icon"),g=(0,i.up)("el-dropdown-item"),h=(0,i.up)("el-dropdown-menu"),w=(0,i.up)("el-dropdown"),v=(0,i.up)("el-header"),y=(0,i.up)("el-aside");return(0,i.wg)(),(0,i.j4)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[e.errMsg?((0,i.wg)(),(0,i.j4)(u,{key:0,type:"info",message:e.errMsg},null,8,["message"])):e.ready?((0,i.wg)(),(0,i.j4)(c,(0,r.vs)((0,i.dG)({key:1},e.props)),null,16)):(0,i.kq)("",!0)])),_:1})])),_:1}),(0,i.Wm)(y,{width:"200px"},{default:(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(w,{onCommand:e.changeLang,class:"el-dropdown"},{dropdown:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(g,{disabled:"zh"===e.language,command:"zh"},{default:(0,i.w5)((()=>[(0,i.Uk)(" 中文 ")])),_:1},8,["disabled"]),(0,i.Wm)(g,{disabled:"en"===e.language,command:"en"},{default:(0,i.w5)((()=>[(0,i.Uk)(" English ")])),_:1},8,["disabled"]),(0,i.Wm)(g,{disabled:"pt-br"===e.language,command:"ptBr"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Português (Brasil) ")])),_:1},8,["disabled"])])),_:1})])),default:(0,i.w5)((()=>[(0,i._)("span",l,[(0,i.Uk)(" language"),(0,i.Wm)(p,{class:"el-icon--right"},{default:(0,i.w5)((()=>[(0,i.Wm)(f)])),_:1})])])),_:1},8,["onCommand"])])),_:1})])),_:1})])),_:1})}var c=n(2262),d=n(8718),m=n.n(d),f=n(6604),p=n.n(f),g=n(7563);const h={room:"",anchor:"",cors:"false",face:"false",faceExpireDay:"",display:"bottom",stay:"",limit:"",giftComb:"",giftPin:"",delay:"",blockUID:"",debug:"",deeplToken:"",translateFrom:"",corsProxyUrl:"",translateTo:"PT-BR"};Object.freeze(h);const w=["room","anchor","faceExpireDay","stay","giftComb","limit","giftPin","delay"];Object.freeze(w);const v=new Set(w);Object.freeze(v);const y=e=>v.has(e),k={faceExpireDay:7};Object.freeze(k);const b=p()(h,((e,t)=>v.has(t)?Number:String));Object.freeze(b);let _=()=>({cors:[{value:"false",text:(0,s.l3)("关闭（所有跨域请求将依赖 codetabs，限制 5 请求/秒）")},{value:"true",text:(0,s.l3)("开启（请阅读右侧说明）")}],face:[{value:"false",text:(0,s.l3)("不显示")},{value:"gift",text:(0,s.l3)("仅对礼物显示，不需要额外调用 API")},{value:"true",text:(0,s.l3)("显示，通过 Bilibili API 获取（跨域）")},{value:"imjad",text:(0,s.l3)("显示，通过 HibiAPI 获取")}],display:[{value:"bottom",text:(0,s.l3)("自底部")},{value:"top",text:(0,s.l3)("从顶部")}]});const S=e=>p()(m()({...h,...(0,g.parse)(e)},Object.keys(h)),((e,t)=>y(t)?e&&parseInt(e)||k[t]||0:t in _?_[t].some((({value:t})=>t===e))?e:h[t]:e||h[t]));var T=n(6154);let D=!0;const x=e=>D=e,P=e=>fetch(e,{referrer:"",referrerPolicy:"no-referrer",mode:"no-cors"}).then((e=>e.json())),j=e=>fetch(`https://api.codetabs.com/v1/proxy/?quest=${e}`).then((e=>e.json())),L=e=>D?P(e):j(e),O=T.Z.create({timeout:6e3});O.interceptors.request.use((e=>(localStorage._token&&(e.headers.Authorization=localStorage._token),e))),O.interceptors.response.use((e=>e),(e=>{if(e.response){let{status:t}=e.response;switch(t){case 404:console.error(e.response.message);break;case 500:console.error(e.response.statusText);break}}return Promise.reject(e)}));const $={get(e,t){return new Promise(((n,a)=>{O.get(e,t).then((e=>{e&&n(e.data)})).catch((e=>{a(e)}))}))},post(e,t,n){return new Promise(((a,o)=>{O.post(e,t,n).then((e=>{console.log(e),e&&a(e.data)})).catch((e=>{o(e)}))}))},delete(e,t){return new Promise(((n,a)=>{O.delete(e,{data:t}).then((e=>{e&&n(e.data)})).catch((e=>{a(e)}))}))},put(e,t){return new Promise(((n,a)=>{O.put(e,t).then((e=>{e&&n(e.data)})).catch((e=>{a(e)}))}))},fetch(e,t){return new Promise(((n,a)=>{fetch(e,t).then((e=>{e&&n(e.json())})).catch((e=>{a(e)}))}))}},E=async(e,t,n,a)=>{var o=new URLSearchParams;o.append("text",n),o.append("source_lang",e),o.append("target_lang",t);var s={method:"POST",headers:{Authorization:localStorage._token,"Content-Type":"application/x-www-form-urlencoded"},body:o,redirect:"follow"};return await $.fetch(a+"/https://api-free.deepl.com/v2/translate",s).then((e=>e))};var z=n(928),A=n.n(z),F=n(7204),H=n.n(F),M=n(3279),C=n.n(M),I=n(7247);const R=()=>Math.floor(Date.now()/864e5),G={method:"false",expireDay:7},N=e=>Object.assign(G,e),U=e=>{switch(G.method){case"imjad":return P(`https://api.obfs.dev/api/bilibili/v3/user_info?uid=${e}&size=1`).then((e=>{var t,n;return null===(t=e.data)||void 0===t||null===(n=t.card)||void 0===n?void 0:n.face}));default:return L(`https://api.bilibili.com/x/web-interface/card?mid=${e}`).then((e=>{var t,n;return null===(t=e.data)||void 0===t||null===(n=t.card)||void 0===n?void 0:n.face}))}},B=([e,t])=>{t||(t="member/noface.jpg");const n=A()(t.split(".")),a=`https://i${e}.hdslb.com/bfs/face/${t}`;return"gif"===n?[[a,0]]:[[`${a}_48x48.${n}`,2e3],[a,5e3]]},W=([,,e])=>!e||R()-e>=G.expireDay,q=new Map(Object.entries((0,I.M)("face",{})).filter((([,e])=>!W(e))).map((([e,t])=>[Number(e),t]))),J=C()((()=>(0,I.y)("face",H()(Array.from(q)))),5e3,{maxWait:5e3}),Z=(e,t)=>{var n;if(!t)return;const a=parseInt(null===(n=/\/\/i(\d+)\./.exec(t))||void 0===n?void 0:n[1])||0,o=A()(t.split("/")),s=o.includes("noface")?[0,null,R()]:[a,o,R()];return q.set(e,s),J(),s},K=async e=>{const t=q.get(e);if(t&&!W(t))return B(t);try{return B(Z(e,await U(e)))}catch(n){console.error("[face API error]",n)}return B([0,null])},Y={id:"live"};function Q(e,t,n,a,o,s){const r=(0,i.up)("danmaku-list");return(0,i.wg)(),(0,i.iD)("div",Y,[a.props.giftPin?((0,i.wg)(),(0,i.j4)(r,(0,i.dG)({key:0,ref:"giftPinList"},a.props,{"gift-show-face":a.giftShowFace,"is-gift-list":!0}),null,16,["gift-show-face"])):(0,i.kq)("",!0),(0,i.Wm)(r,(0,i.dG)({ref:"danmakuList"},a.props),null,16)])}var V=n(4171);const X={key:0,class:"danmaku-list-pinned",ref:"danmakuListRef"},ee={class:"danmaku-list hidden"},te={class:"danmaku-list absolute",ref:"giftListRef"},ne={key:1,class:"danmaku-list",ref:"danmakuListRef"},ae={key:0,class:"danmaku-list-placeholder"};function oe(e,t,n,a,o,s){const r=(0,i.up)("danmaku-item");return n.isGiftList?((0,i.wg)(),(0,i.iD)("div",X,[(0,i._)("div",ee,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.giftPin,(e=>((0,i.wg)(),(0,i.j4)(r,{key:e,"show-face":n.giftShowFace,type:"gift",uname:"某人",giftName:"礼物",num:e},null,8,["show-face","num"])))),128))]),(0,i._)("div",te,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.danmakuList,(e=>((0,i.wg)(),(0,i.j4)(r,(0,i.dG)({key:e.key},e.props,{hidden:e.hidden,ref_for:!0,ref:t=>e.el=t}),null,16,["hidden"])))),128))],512)],512)):((0,i.wg)(),(0,i.iD)("div",ne,["bottom"===e.display?((0,i.wg)(),(0,i.iD)("div",ae)):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.danmakuList,(e=>((0,i.wg)(),(0,i.j4)(r,(0,i.dG)({key:e.key},e.props,{hidden:e.hidden,ref_for:!0,ref:t=>e.el=t}),null,16,["hidden"])))),128))],512))}var se=n(2404),ie=n.n(se),re=(n(7658),n(7632));const le=(e,t)=>new Promise(((n,a)=>{let o=0;const s=new XMLHttpRequest,i=setTimeout((()=>{s.abort()}),1e4),r=t?setTimeout((()=>{0===o&&s.abort()}),t):null;s.open("GET",e,!0),s.onprogress=e=>{e.lengthComputable&&(o=e.loaded/e.total)},s.onload=()=>{clearTimeout(r),clearTimeout(i),n(e)},s.onerror=a,s.onabort=a,s.send()}));var ue=async e=>{for(const[t,n]of e){const e=await le(t,n).catch((()=>{console.warn("Timeout",t)}));if(e)return e}return e[0][0]||""};const ce=["src"],de={key:1,class:"danmaku-content"},me={class:"danmaku-message"},fe={key:2,class:"danmaku-content"},pe={class:"danmaku-message"},ge={class:"danmaku-author-name"},he={class:"danmaku-message"},we={class:"danmaku-gift-name"},ve=(0,i._)("span",{class:"danmaku-message"}," × ",-1),ye={class:"danmaku-gift-num"},ke={key:3,class:"danmaku-content"},be={class:"danmaku-message"},_e={class:"danmaku-author-name"},Se={class:"danmaku-message"},Te={key:4,class:"danmaku-content"},De={class:"danmaku-message"};function xe(e,t,n,a,o,s){return(0,i.wg)(),(0,i.iD)("div",{class:(0,r.C_)(["danmaku-item",{hidden:a.isHidden}])},[n.showFace?((0,i.wg)(),(0,i.iD)("img",{key:0,class:"danmaku-author-face",src:n.face},null,8,ce)):(0,i.kq)("",!0),"message"===n.type?((0,i.wg)(),(0,i.iD)("div",de,[(0,i._)("span",{class:(0,r.C_)(["danmaku-author-name with-colon",{anchor:n.isAnchor,owner:n.isOwner}])},(0,r.zw)(n.uname),3),(0,i._)("span",me,(0,r.zw)(n.message),1)])):"gift"===n.type?((0,i.wg)(),(0,i.iD)("div",fe,[(0,i._)("span",pe,(0,r.zw)(s.$lang("感谢")),1),(0,i._)("span",ge,(0,r.zw)(n.uname),1),(0,i._)("span",he," "+(0,r.zw)(s.$lang("赠送")),1),(0,i._)("span",we,(0,r.zw)(n.giftName),1),ve,(0,i._)("span",ye,(0,r.zw)(n.num),1)])):"sc"===n.type?((0,i.wg)(),(0,i.iD)("div",ke,[(0,i._)("span",be,(0,r.zw)(s.$lang("感谢")),1),(0,i._)("span",_e,(0,r.zw)(n.uname),1),(0,i._)("span",Se," SC："+(0,r.zw)(n.message),1)])):"info"===n.type?((0,i.wg)(),(0,i.iD)("div",Te,[(0,i._)("span",De,(0,r.zw)(n.message),1)])):(0,i.kq)("",!0)],2)}var Pe={methods:{$lang:s.l3},props:{type:{type:String,default:"message"},showFace:Boolean,face:String,uid:Number,uname:String,message:String,isAnchor:Boolean,isOwner:Boolean,action:String,giftName:String,num:Number,stay:Number,hidden:Boolean},setup(e){const t=(0,c.iH)(!1),n=(0,c.iH)(!1);if(e.stay){const a=setTimeout((()=>{t.value=!0,"info"===e.type&&setTimeout((()=>n.value=!0),800)}),e.stay);(0,i.Jd)((()=>clearTimeout(a)))}const a=(0,i.Fl)((()=>e.hidden||t.value));return{...(0,c.BK)(e),isHidden:a,needRemoved:n}}},je=n(3744);const Le=(0,je.Z)(Pe,[["render",xe]]);var Oe=Le;const $e=new Map;var Ee={components:{DanmakuItem:Oe},props:{...b,isGiftList:Boolean,giftShowFace:Boolean},setup(e){let t=!0;(0,i.Jd)((()=>t=!1));const n=(0,c.iH)([]),a=(0,c.iH)(null),o=(0,c.iH)(null);(0,i.bv)((()=>{const e=a.value.getBoundingClientRect().top-5,t=()=>{const t=n.value.findIndex((t=>{var n,a,o,s;const{top:i=e,height:r=0}=null!==(n=null===(a=t.el)||void 0===a||null===(o=a.$el)||void 0===o?void 0:o.getBoundingClientRect())&&void 0!==n?n:{};return i<e&&(t.hidden=!0),i+r>e&&!(null!==(s=t.el)&&void 0!==s&&s.needRemoved)}));t>0&&n.value.splice(0,t)},o=setInterval(t,100);(0,i.Jd)((()=>clearInterval(o)))}));const s=()=>{const t=(0,c.SU)(e.isGiftList?o:a);t&&(t.scrollTop=t.scrollHeight)};e.isGiftList||((0,i.bv)((()=>window.addEventListener("resize",s))),(0,i.Jd)((()=>window.removeEventListener("resize",s))));const r=[],l=()=>{let e=200;const{length:a}=r;a>0&&(e=Math.min(e,1e3/a),n.value.push(r.shift()),(0,i.Y3)(s)),t&&setTimeout(l,e)};l();const u=async t=>{if(t.showFace){const e=await K(t.uid);let n,[a]=e.find((([e])=>n=$e.get(e)))||[""];a?!0!==n&&(a=await n):(n=ue(e),$e.set(a,n),a=await n,$e.set(a,!0)),t.face=a}t.stay=t.stay||("bottom"===e.display?e.stay:0),r.push({props:t,key:(0,re.Z)(),el:null,hidden:!1})},d=[];if(e.limit){const t=setInterval((()=>{let t=d.splice(0);t.length&&(t.length>e.limit&&(t=ie()(Object.keys(t),e.limit).sort().map((e=>t[e]))),t.forEach((e=>u(e))))}),1e3);(0,i.Jd)((()=>clearInterval(t)))}const m=e=>d.push(e);return{...(0,c.BK)(e),danmakuList:n,danmakuListRef:a,giftListRef:o,addDanmaku:u,addSpeedLimitDanmaku:m}}};const ze=(0,je.Z)(Ee,[["render",oe]]);var Ae=ze,Fe={components:{DanmakuList:Ae},props:b,setup(e){const t=(0,c.iH)(null),n=(0,c.iH)(null),a=new Map,o=(0,i.Fl)((()=>!["false","gift"].includes(e.face))),s=(0,i.Fl)((()=>new Set(e.blockUID.split("|").map((e=>e.trim()))))),r=e=>s.value.has(String(e)),l=t=>{n.value.addDanmaku({type:"info",message:t,stay:e.stay||5e3})},u=t=>{e.limit?n.value.addSpeedLimitDanmaku(t):n.value.addDanmaku(t)};return(0,i.bv)((()=>{console.log("正在连接直播弹幕服务器");const s=new V.KeepLiveWS(e.room);(0,i.Jd)((()=>s.close())),s.on("open",(()=>{console.log("已连接直播弹幕服务器"),l("已连接直播弹幕服务器")})),s.on("live",(()=>{console.log("已连接直播间",e.room),l(`已连接直播间 ${e.room}`)})),s.on("close",(()=>console.log("已断开与直播弹幕服务器的连接"))),s.on("heartbeat",(e=>console.log("当前人气值",e)));const c=e.giftPin?t:n;s.on("SEND_GIFT",(({data:{uid:t,uname:n,action:o,giftName:s,num:i,face:l}})=>{if(r(t))console.log(`屏蔽了来自[${n}]的礼物：${s}*${i}`);else if(Z(t,l),e.giftComb){const r=`${t}-${s}`,l=a.get(r);l?a.set(r,{...l,num:l.num+i}):(a.set(r,{type:"gift",showFace:"false"!==e.face,uid:t,uname:n,action:o,giftName:s,num:i}),setTimeout((()=>{c.value.addDanmaku(a.get(r)),a.delete(r)}),e.giftComb))}else c.value.addDanmaku({type:"gift",showFace:"false"!==e.face,uid:t,uname:n,action:o,giftName:s,num:i})})),s.on("DANMU_MSG",(async({info:[,t,[n,a,s]]})=>{if(r(n))return void console.log(`屏蔽了来自[${a}]的弹幕：${t}`);if(e.deeplToken){localStorage._token=`DeepL-Auth-Key ${e.deeplToken}`;let n=await E(e.translateFrom,e.translateTo,t,e.corsProxyUrl);t+="    "+e.translateTo+":"+n.translations[0].text}const i={type:"message",showFace:o.value,uid:n,uname:a,message:t,isAnchor:n===e.anchor,isOwner:!!s};e.delay>0?setTimeout((()=>u(i)),1e3*e.delay):u(i)})),s.on("SUPER_CHAT_MESSAGE",(async t=>{console.log("SUPER_CHAT_MESSAGE",t);let{data:{uid:n,user_info:{uname:a},message:o}}=t;if(e.deeplToken){localStorage._token=`DeepL-Auth-Key ${e.deeplToken}`;let t=await E(e.translateFrom,e.translateTo,o,e.corsProxyUrl);o+="/"+e.translateTo+":"+t.translations[0].text}c.value.addDanmaku({type:"sc",showFace:"false"!==e.face,uid:n,uname:a,message:o})})),window.giftList=c,s.on("SUPER_CHAT_MESSAGE_JPN",(e=>console.log("SUPER_CHAT_MESSAGE_JPN",e))),s.on("USER_TOAST_MSG",(t=>{const{data:{uid:n,username:a,role_name:o,num:s}}=t;c.value.addDanmaku({type:"gift",showFace:"false"!==e.face,uid:n,uname:a,giftName:o,num:s})}))})),{props:e,giftShowFace:o,giftPinList:t,danmakuList:n}}};const He=(0,je.Z)(Fe,[["render",Q]]);var Me=He,Ce=n(6309),Ie=n(7475),Re=n(9150);const Ge=()=>{const{proxy:{$lang:e}}=(0,i.FN)();return{$lang:e}},Ne=(0,Ce.e7M)();var Ue=(0,i.aZ)({components:{Live:Me,DanmakuItem:Oe},setup(){const e=()=>window.location.reload();window.addEventListener("hashchange",e),(0,i.Jd)((()=>window.removeEventListener("hashchange",e)));const{$lang:t}=Ge(),n=(0,c.qj)(S(window.location.hash)),a="true"===n.cors;x(a),N({method:n.face,expireDay:n.faceExpireDay});const o=(0,c.iH)(!1),s=(0,c.iH)("");n.anchor?o.value=!0:L(`https://api.live.bilibili.com/room/v1/Room/room_init?id=${n.room}`).then((({code:e,msg:t,data:{room_id:a,uid:i}})=>{0===e?(n.room=parseInt(a),n.anchor=parseInt(i),o.value=!0):s.value=t})).catch((()=>{s.value="获取房间信息失败",a&&(s.value+="，请检查是否正确禁用了浏览器的 web security 以允许直接跨域")}));const{locale:r}=(0,Re.QT)(),l=e=>{r.value=e,localStorage.setItem("lang",e)};n.debug&&import("https://fastly.jsdelivr.net/npm/vconsole/dist/vconsole.min.js").then((()=>{new window.VConsole}));let u=()=>{const e=(0,Ie.OT)(Ne);console.log(e())};return{props:n,ready:o,errMsg:s,switchThemes:u,$lang:t,changeLang:l}}});const Be=(0,je.Z)(Ue,[["render",u]]);var We=Be;const qe=(0,a.ri)(We);qe.use(o.Z),qe.use(s.ZP),qe.mount("#app")}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.m=e,function(){var e=[];n.O=function(t,a,o,s){if(!a){var i=1/0;for(c=0;c<e.length;c++){a=e[c][0],o=e[c][1],s=e[c][2];for(var r=!0,l=0;l<a.length;l++)(!1&s||i>=s)&&Object.keys(n.O).every((function(e){return n.O[e](a[l])}))?a.splice(l--,1):(r=!1,s<i&&(i=s));if(r){e.splice(c--,1);var u=o();void 0!==u&&(t=u)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[a,o,s]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={576:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,s,i=a[0],r=a[1],l=a[2],u=0;if(i.some((function(t){return 0!==e[t]}))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(l)var c=l(n)}for(t&&t(a);u<i.length;u++)s=i[u],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(c)},a=self["webpackChunkbilibili_live_chat"]=self["webpackChunkbilibili_live_chat"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[64,639],(function(){return n(657)}));a=n.O(a)})();